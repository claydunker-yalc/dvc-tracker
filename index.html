<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVC Master Tracker</title>
    <style>
        @font-face { font-family: 'DisneyMagic'; src: url('waltograph42.ttf'); }
        @font-face { font-family: 'UniversBold'; src: url('SNBold.ttf'); }
        @font-face { font-family: 'UniversRegular'; src: url('SNRegular.ttf'); }

        :root {
            --sign-purple: #3b1660; 
            --sign-red: #d31130;    
            --sign-yellow: #fff200; 
            --sign-blue: #0072bc;   
            --sign-white: #ffffff;
        }

        html, body { margin: 0; padding: 0; min-height: 100%; }
        body {
            background: url('background.png') no-repeat center bottom fixed;
            background-size: cover;
            font-family: 'UniversRegular', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 80px;
        }

        .spacer-top { height: 12vh; width: 100%; flex-shrink: 0; }

        .sign-container {
            max-width: 650px;
            width: 90%;
            background-color: var(--sign-purple);
            color: var(--sign-white);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            border: 6px solid #333;
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header { padding: 25px 20px; text-align: center; }
        h1 { font-family: 'DisneyMagic', cursive; margin: 0; font-size: 3.2rem; color: var(--sign-white); text-shadow: 3px 3px 0px var(--sign-blue); }
        .straight-ahead { font-family: 'UniversBold'; color: var(--sign-yellow); letter-spacing: 4px; font-size: 1.2rem; margin-top: 5px; }

        .tabs { display: flex; background: rgba(0,0,0,0.4); border-top: 4px solid var(--sign-red); border-bottom: 4px solid var(--sign-red); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: white; font-family: 'UniversBold', sans-serif; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; }
        .tab-btn.active { background: var(--sign-red); color: var(--sign-yellow); }

        .tab-content { display: none; padding: 25px; }
        .tab-content.active { display: block; }

        .total-points-sign { font-family: 'UniversBold'; font-size: 2.5rem; color: var(--sign-yellow); text-align: center; margin-bottom: 20px; }
        .summary-card { background: white; color: #333; border-radius: 4px; margin-bottom: 15px; padding: 18px; border-left: 12px solid var(--sign-blue); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .trip-card { background: var(--sign-yellow); color: #222; padding: 14px; border-radius: 4px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; font-family: 'UniversBold'; }

        .footer-red { background-color: var(--sign-red); padding: 15px; text-align: center; font-family: 'UniversBold'; font-size: 1.1rem; color: var(--sign-yellow); letter-spacing: 2px; text-transform: uppercase; }
        
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; box-sizing: border-box; font-family: 'UniversRegular'; font-size: 1rem; }
        .used-input { width: 120px !important; padding: 8px !important; font-size: 1.2rem !important; text-align: center; font-weight: bold; }
        
        .disney-button { background: var(--sign-yellow); color: #333; border: none; padding: 18px; font-family: 'UniversBold'; cursor: pointer; text-transform: uppercase; width: 100%; border-radius: 4px; font-size: 1rem; margin-bottom: 10px;}
        .sync-section { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px dashed var(--sign-yellow); }
    </style>
</head>
<body>

<div class="spacer-top"></div>

<div class="sign-container">
    <header>
        <h1>Dvc Point Tracker</h1>
        <div class="straight-ahead">STRAIGHT AHEAD</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('home')">Dashboard</button>
        <button class="tab-btn" onclick="showTab('trips')">Trips</button>
        <button class="tab-btn" onclick="showTab('settings')">Contracts</button>
    </div>

    <div id="home" class="tab-content active">
        <div id="grandTotal" class="total-points-sign">TOTAL: 0 PTS</div>
        <div id="nextTripDisplay"></div>
        <h3 style="border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 8px;">CURRENT STANDING</h3>
        <div id="contractSummary"></div>
    </div>

    <div id="trips" class="tab-content">
        <div id="tripManager"></div>
    </div>

    <div id="settings" class="tab-content">
        <div id="contractEditor"></div>
        
        <div class="sync-section">
            <h4 style="margin-top:0; color:var(--sign-yellow)">DATA MANAGEMENT</h4>
            <button class="disney-button" onclick="exportData()">DOWNLOAD SYNC FILE</button>
            <label class="disney-button" style="display:block; text-align:center; background:var(--sign-blue); color:white;">
                UPLOAD SYNC FILE
                <input type="file" id="importFile" style="display:none" onchange="importData(event)">
            </label>
            <p style="font-size:0.7rem; color:#aaa; margin-bottom:0">Download the file and send it to your wife to sync her app!</p>
        </div>
    </div>

    <div class="footer-red">THE MOST MAGICAL PLACE ON EARTH</div>
</div>

<script>
    let data = { contracts: [], trips: [] };

    function init() {
        const backup = localStorage.getItem('dvc_data_final');
        if(backup) {
            data = JSON.parse(backup);
        } else {
            // Default placeholder if empty
            data = { 
                contracts: [{id: 1, resort: "Animal Kingdom Lodge", annual: 200, banked: 0, borrowed: 0, used: 0, uy: "Feb"}], 
                trips: [] 
            };
        }
        render();
    }

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function updatePoints(id, field, val) {
        const idx = data.contracts.findIndex(c => c.id === id);
        data.contracts[idx][field] = parseInt(val) || 0;
        localStorage.setItem('dvc_data_final', JSON.stringify(data));
        render();
    }

    // EXPORT DATA TO FILE
    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "dvc_sync_data.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    // IMPORT DATA FROM FILE
    function importData(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            data = JSON.parse(e.target.result);
            localStorage.setItem('dvc_data_final', JSON.stringify(data));
            render();
            alert("Sync Successful! Welcome Home.");
        };
        reader.readAsText(event.target.files[0]);
    }

    function render() {
        const summary = document.getElementById('contractSummary');
        const editor = document.getElementById('contractEditor');
        const nextTripDiv = document.getElementById('nextTripDisplay');
        let total = 0;

        summary.innerHTML = ''; editor.innerHTML = '';
        
        data.contracts.forEach(c => {
            const avail = (c.annual + (c.banked || 0) + (c.borrowed || 0)) - (c.used || 0);
            total += avail;
            summary.innerHTML += `<div class="summary-card"><strong>${c.resort}</strong><span style="float:right;">${avail} PTS</span></div>`;
            editor.innerHTML += `<div class="summary-card"><strong>${c.resort}</strong><div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; font-size:0.7rem"><span>Banked<br><input type="number" value="${c.banked}" onchange="updatePoints(${c.id}, 'banked', this.value)"></span><span>Annual<br><input type="number" value="${c.annual}" disabled></span><span>Borrow<br><input type="number" value="${c.borrowed}" onchange="updatePoints(${c.id}, 'borrowed', this.value)"></span></div><div style="text-align:right; margin-top:10px;">Used: <input type="number" class="used-input" value="${c.used}" onchange="updatePoints(${c.id}, 'used', this.value)"></div></div>`;
        });
        document.getElementById('grandTotal').innerText = `TOTAL: ${total} PTS`;
    }
    init();
</script>
</body>
</html>
